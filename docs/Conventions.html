<!DOCTYPE html>

<html>
<head>
  <title>Conventions.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Document.html">
                Document.coffee
              </a>
            
              
              <a class="source" href="Engine.html">
                Engine.coffee
              </a>
            
              
              <a class="source" href="Parser.html">
                Parser.coffee
              </a>
            
              
              <a class="source" href="Solver.html">
                Solver.coffee
              </a>
            
              
              <a class="source" href="Algebra.html">
                Algebra.coffee
              </a>
            
              
              <a class="source" href="Constraints.html">
                Constraints.coffee
              </a>
            
              
              <a class="source" href="Conventions.html">
                Conventions.coffee
              </a>
            
              
              <a class="source" href="Measurements.html">
                Measurements.coffee
              </a>
            
              
              <a class="source" href="Native.html">
                Native.coffee
              </a>
            
              
              <a class="source" href="Rules.html">
                Rules.coffee
              </a>
            
              
              <a class="source" href="Selectors.html">
                Selectors.coffee
              </a>
            
              
              <a class="source" href="Transformations.html">
                Transformations.coffee
              </a>
            
              
              <a class="source" href="Types.html">
                Types.coffee
              </a>
            
              
              <a class="source" href="Units.html">
                Units.coffee
              </a>
            
              
              <a class="source" href="Buffer.html">
                Buffer.coffee
              </a>
            
              
              <a class="source" href="Command.html">
                Command.coffee
              </a>
            
              
              <a class="source" href="Console.html">
                Console.coffee
              </a>
            
              
              <a class="source" href="EventTrigger.html">
                EventTrigger.coffee
              </a>
            
              
              <a class="source" href="Helper.html">
                Helper.coffee
              </a>
            
              
              <a class="source" href="Property.html">
                Property.coffee
              </a>
            
              
              <a class="source" href="Style.html">
                Style.coffee
              </a>
            
              
              <a class="source" href="Expressions.html">
                Expressions.coffee
              </a>
            
              
              <a class="source" href="Queries.html">
                Queries.coffee
              </a>
            
              
              <a class="source" href="Values.html">
                Values.coffee
              </a>
            
              
              <a class="source" href="Restyles.html">
                Restyles.coffee
              </a>
            
              
              <a class="source" href="Solutions.html">
                Solutions.coffee
              </a>
            
              
              <a class="source" href="Dimensions.html">
                Dimensions.coffee
              </a>
            
              
              <a class="source" href="Equasions.html">
                Equasions.coffee
              </a>
            
              
              <a class="source" href="Styles.html">
                Styles.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Conventions.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="-"> </h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="conventions">Conventions</h1>
<p>Okay what’s the deal with those → ↓ ↑ arrows? 
Open your mind and think beyond this Unicode madness. </p>
<p>Dynamic systems need to be able to clean up side effects
Instead of linking things together, we are use a tracking system
that generates determenistic unique string keys
that are used for multiple purposes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
↑  Caching, e.g. to jump to results <span class="hljs-keyword">of</span> dom query,
   <span class="hljs-keyword">or</span> to figure out which element <span class="hljs-keyword">in</span> that collection 
   called <span class="hljs-keyword">this</span> <span class="hljs-reserved">function</span> (↑)

→  Linking, that allows lazy evaluation, <span class="hljs-keyword">by</span> making arguments
   depend <span class="hljs-literal">on</span> previously resolved arguments,
   e.g. <span class="hljs-keyword">for</span> plural binding <span class="hljs-keyword">or</span> to generate unique argument signature

↓  Nesting, as a way <span class="hljs-keyword">for</span> expressions to own side effects,
   e.g. to remove stylesheet, css rule <span class="hljs-keyword">or</span> conditional branch</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>These arrows are delimeters that combined together 
enable bottom-up evaluation and continuations
without leaving any state behind. 
Continuations without explicit state.</p>
<p>It’s a lot easier to clean up stateless systems. 
Whenever a string key is set to be cleaned up,
it broadcasts that intent to all subsystems, 
like constraint solver, dom observer, etc.
So they can clean up things related to that key
by triggering more remove commands for known sub-keys.</p>
<p>This removal cascade allows components to have strict
and arbitarily deep hierarchy, without knowing of it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    style$my-stylesheet   <span class="hljs-comment"># my stylesheet</span>
               ↓ h1$h1    <span class="hljs-comment"># found heading</span>
               ↑ !+img    <span class="hljs-comment"># preceeded by image</span>
               → <span class="hljs-comment">#header  # bound to header element</span>

    &lt;style id=<span class="hljs-string">"my-stylesheet"</span>&gt;
      (h1 !+ img)[width] == <span class="hljs-comment">#header[width]</span>
    &lt;/style&gt;
    &lt;header id=<span class="hljs-string">"header"</span>&gt;
      &lt;img&gt;
      &lt;h1 id=<span class="hljs-string">"h1"</span>&gt;&lt;/h1&gt;
    &lt;/header&gt;

.</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Conventions</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Return concatenated path for a given object and prefix
Removes trailing delimeter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getContinuation</span>: <span class="hljs-function"><span class="hljs-params">(path, value, suffix = <span class="hljs-string">''</span>)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> path
      path = path.replace(<span class="hljs-regexp">/[→↓↑]$/</span>, <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>return path unless value?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> value <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span>
    <span class="hljs-keyword">return</span> path + (value &amp;&amp; <span class="hljs-property">@identify</span>(value) || <span class="hljs-string">''</span>) + suffix</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>When cleaning a path, also clean forks, rules and pairs
This is a little bit of necessary evil in </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getPossibleContinuations</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span>
    [path, path + <span class="hljs-property">@UP</span>, path + <span class="hljs-property">@RIGHT</span>, path + <span class="hljs-property">@DOWN</span>]

  <span class="hljs-attribute">getPath</span>: <span class="hljs-function"><span class="hljs-params">(id, property)</span> -&gt;</span>
    <span class="hljs-keyword">unless</span> property
      property = id
      id = <span class="hljs-literal">undefined</span>
    <span class="hljs-keyword">if</span> property.indexOf(<span class="hljs-string">'['</span>) &gt; -<span class="hljs-number">1</span> || !id
      <span class="hljs-keyword">return</span> property
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> id + <span class="hljs-string">'['</span> + property + <span class="hljs-string">']'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Hook: Should interpreter iterate returned object?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">isCollection</span>: <span class="hljs-function"><span class="hljs-params">(object)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>(yes, if it’s a collection of objects or empty array)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> object &amp;&amp; object.length != <span class="hljs-literal">undefined</span> &amp;&amp; !object.substring &amp;&amp; !object.nodeType
      <span class="hljs-keyword">switch</span> <span class="hljs-keyword">typeof</span> object[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">when</span> <span class="hljs-string">"object"</span>
          <span class="hljs-keyword">return</span> object[<span class="hljs-number">0</span>].nodeType
        <span class="hljs-keyword">when</span> <span class="hljs-string">"undefined"</span>
          <span class="hljs-keyword">return</span> object.length == <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return shared absolute path of a dom query ($id selector) </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getQueryPath</span>: <span class="hljs-function"><span class="hljs-params">(operation, continuation)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> continuation
      <span class="hljs-keyword">if</span> continuation.nodeType
        <span class="hljs-keyword">return</span> <span class="hljs-property">@identify</span>(continuation) + <span class="hljs-string">' '</span> + operation.path
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> continuation + operation.key
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> operation.key</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Check if selector is bound to current scope’s element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">getContext</span>: <span class="hljs-function"><span class="hljs-params">(args, operation, scope, node)</span> -&gt;</span>
    index = args[<span class="hljs-number">0</span>].def &amp;&amp; <span class="hljs-number">4</span> || <span class="hljs-number">0</span>
    <span class="hljs-keyword">if</span> (args.length != index &amp;&amp; (args[index]?.nodeType))
      <span class="hljs-keyword">return</span> args[index]
    <span class="hljs-keyword">if</span> !operation.bound
      <span class="hljs-keyword">return</span> <span class="hljs-property">@scope</span>
    <span class="hljs-keyword">return</span> scope;

  <span class="hljs-attribute">getIntrinsicProperty</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span>
    index = path.indexOf(<span class="hljs-string">'intrinsic-'</span>)
    <span class="hljs-keyword">if</span> index &gt; -<span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> (last = path.indexOf(<span class="hljs-string">']'</span>, index)) == -<span class="hljs-number">1</span>
        last = <span class="hljs-literal">undefined</span>
      <span class="hljs-keyword">return</span> property = path.substring(index + <span class="hljs-number">10</span>, last)

  <span class="hljs-attribute">isPrimitive</span>: <span class="hljs-function"><span class="hljs-params">(object)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Objects are allowed only if they define custom valueOf function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> object == <span class="hljs-string">'object'</span>
      <span class="hljs-keyword">return</span> object.valueOf != Object.prototype.valueOf
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Execution has forked (found many elements, trying brute force to complete selector)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">UP</span>:    <span class="hljs-string">'↑'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>One selector was resolved, expecting another selector to pair up</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">RIGHT</span>: <span class="hljs-string">'→'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Execution goes depth first (inside stylesheet or css rule)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">DOWN</span>:  <span class="hljs-string">'↓'</span>

<span class="hljs-built_in">module</span>.exports = Conventions</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
