<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>GSS engine in browser</title>
    <script src="../vendor/weakmap.js"></script>
    <script src="../vendor/MutationObserver.js"></script>
    <script src="../dist/gss.js"></script>
    <!--<script src="../vendor/c.js"></script> -->

    <style>
      #mocha .test {
        overflow: auto;
      }
      header {
        background: orange;
        height: 50px;
      }

      main {
        background: yellow;
        height: 100px;
        z-index: 10;
      }

      footer {
        background: red;
        width: 10px;
        height: 20px;
      }

      aside {
        background: blue;
        width: 100px;
      }

      ul li {
        list-style: none;
        background: green;
        top: 5px;
      }
    </style>
  </head>
  <body>
    <style type="text/gss">
      // plural selectors can be used as singular, a la jQ
      [left-margin] == (main)[right];

      // global condition with nested rules
      @if (#main)[top] > 50 {
        main {
          background: red;
        }
      } @else {
        main {
          background: yellow;
        }
      }

      header {
        ::[left] == 0;
        // condition inside css rule
        @if (::window[width] > ::window[height]) {
          ::[width] == ::window[width] / 4;
        } @else {
          ::[width] == ::window[width] / 2;
        }
      }

      footer {
        ::[top] == (main)[height]; 
        ::[height] == ::window[height] * 2;
      }

      aside {
        ::[left] == (main)[right];
        ::[height] == 100;
        ::[top] == (header)[intrinsic-height] + (header)[intrinsic-y];
      }

      main {
        // Bind things to scroll position
        ::[top] == ::window[scroll-top] + (header)[intrinsic-y];
        ::[width] == (aside)[intrinsic-width];
        ::[left] == (header)[right];

        // use intrinsic-height to avoid binding. Should be:
        // height: :window[height] - (header)[height];
        ::[height] == ::window[height] - (header)[intrinsic-height];
      }

      // Custom combinators
      ul li !~ li {

        ::[height] == 30;
        
        // FIXME: Regular css style is never removed (needs specificity sorting and groupping);
        background-color: yellowgreen;
      }

      // Chains
      ul li {
        // justify by using variable
        ::[width] == [li-width];

        (&:previous)[right] == &[left];
        (&:last)[right] == ::window[width] - 16;
        (&:first)[left] == 0;
      }
    </style>


    <header id="header"></header>
    <main id="main">
      <ul>
        <li id="li1">1</li>
        <li id="li2">2</li>
        <li id="li3">3</li>
      </ul>
    </main>
    <aside id="aside"></aside>
    <footer id="footer"></footer>

    <script>
      GSS.document = new GSS.Document
    </script>

    <script>
      counter = GSS.$query('ul li').length
      document.onclick = function(e) {
        for (var node = e.target; node; node = node.parentNode)
          if (node.tagName == 'LI')
            return node.parentNode.removeChild(node)

        counter++
        li = document.createElement('li')
        li.id = 'li' + counter
        li.innerHTML = counter
        ul = GSS.$tag('ul')[0].appendChild(li)
      }
    </script>
  </body>
</html>
